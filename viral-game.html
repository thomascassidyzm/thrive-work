<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THRIVE - What Are You Like?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #ffff00;
            border-radius: 50%;
            opacity: 0.6;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10px) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            width: 100%;
            opacity: 0;
            animation: fadeIn 0.2s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .game-card.fade-out {
            animation: fadeOut 0.15s ease forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ffff00, #ffff66, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
        }

        .subtitle {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: #e0e0e0;
            font-weight: 500;
        }

        .description {
            font-size: 1.15rem;
            line-height: 1.7;
            margin-bottom: 2rem;
            color: #c0c0c0;
        }

        .highlight {
            color: #ffff00;
            font-weight: 600;
        }

        .start-button {
            background: linear-gradient(45deg, #ffff00, #ffff66);
            color: #000;
            border: none;
            padding: 1.2rem 2.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.4);
            margin-top: 1rem;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.6);
        }

        /* Question Screen */
        .question-screen {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffff00, #ffff66);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }

        .question-number {
            color: #ffff00;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 2.5rem;
            line-height: 1.6;
            color: #ffffff;
            font-weight: 400;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ffffff;
            font-size: 1.05rem;
            line-height: 1.5;
            text-align: left;
        }

        .option:hover {
            background: rgba(255, 255, 0, 0.15);
            border-color: rgba(255, 255, 0, 0.5);
            transform: translateX(5px);
        }

        .option.selected {
            background: rgba(255, 255, 0, 0.2);
            border-color: rgba(255, 255, 0, 0.6);
        }

        /* Reflection Screen */
        .reflection-screen {
            display: none;
            text-align: center;
        }

        .reflection-title {
            color: #ffff00;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .reflection-text {
            font-size: 1.15rem;
            line-height: 1.7;
            margin-bottom: 2.5rem;
            color: #e0e0e0;
        }

        .reflection-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .reflection-button {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 0, 0.4);
            color: #ffffff;
            padding: 1.1rem 1.8rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.05rem;
            font-weight: 500;
        }

        .reflection-button:hover {
            background: rgba(255, 255, 0, 0.2);
            border-color: rgba(255, 255, 0, 0.6);
            transform: translateY(-2px);
        }

        /* Results Screen */
        .results-screen {
            display: none;
            text-align: center;
        }

        .results-title {
            color: #ffff00;
            font-size: 2.2rem;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .pattern-result {
            background: rgba(255, 255, 0, 0.1);
            border: 2px solid rgba(255, 255, 0, 0.4);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2.5rem;
            text-align: left;
        }

        .pattern-title {
            color: #ffff00;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .pattern-description {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 1.05rem;
            margin-bottom: 1rem;
        }

        .cta-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .cta-title {
            color: #ffff00;
            font-size: 1.6rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .cta-description {
            color: #e0e0e0;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            font-size: 1.05rem;
        }

        .cta-button {
            background: linear-gradient(45deg, #ffff00, #ffff66);
            color: #000;
            border: none;
            padding: 1.2rem 2.5rem;
            font-size: 1.15rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.5);
        }

        .secondary-button {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 0, 0.4);
            color: #ffffff;
            padding: 1rem 2rem;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .secondary-button:hover {
            background: rgba(255, 255, 0, 0.1);
            border-color: rgba(255, 255, 0, 0.6);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .game-card {
                padding: 2rem;
            }

            .logo {
                font-size: 2.5rem;
            }

            .subtitle {
                font-size: 1.4rem;
            }

            .question-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <div class="container">
        <div class="game-card" id="game-card">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="welcome-screen">
                <div class="logo">THRIVE</div>
                <div class="subtitle">What Are You Like?</div>
                <div class="description">
                    Discover the hidden patterns that shape your decisions. This isn't just another personality testâ€”it's a journey into your unconscious mind that reveals the gaps between <span class="highlight">who you think you are</span> and <span class="highlight">who you actually are</span>.
                </div>
                <div class="description">
                    <span class="highlight">10 questions. 5 minutes. Life-changing insights.</span>
                </div>
                <button class="start-button" onclick="startGame()">START EXPLORING</button>
            </div>

            <!-- Question Screen -->
            <div id="question-screen" class="question-screen">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="question-number" id="question-number"></div>
                <div class="question-text" id="question-text"></div>
                <div class="options" id="options"></div>
            </div>

            <!-- Reflection Screen -->
            <div id="reflection-screen" class="reflection-screen">
                <div class="reflection-title">ðŸ¤” Are You Sure?</div>
                <div class="reflection-text">
                    You've just made a choice. Before we continue, take a moment to consider:
                    Is this response truly aligned with how you want to show up in the world,
                    or was it more of an automatic reaction?
                </div>
                <div class="reflection-buttons">
                    <button class="reflection-button" onclick="changeAnswer()">I Want to Change My Answer</button>
                    <button class="reflection-button" onclick="continueFromReflection()">I'm Sure - Continue</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="results-screen">
                <div class="results-title">Your Pattern Revealed</div>

                <div class="pattern-result" id="pattern-result">
                    <!-- Pattern analysis will be inserted here -->
                </div>

                <div class="cta-section">
                    <div class="cta-title">ðŸš€ Want to Know More?</div>
                    <div class="cta-description">
                        This is just the surface. We can go deeper into your specific patterns and show you exactly where the gaps are between your conscious intentions and automatic behaviors.
                    </div>
                    <button class="cta-button" onclick="continueToDeepDive()">YES - SHOW ME MORE</button>
                    <br>
                    <button class="secondary-button" onclick="skipToFullAssessment()">Skip to Full OCEAN Assessment</button>
                </div>

                <button class="secondary-button" onclick="restartGame()">Start Over</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import question banks
        import { thriveVitalityQuestions } from './question-banks/thrive-vitality-questions.js';
        import { thriveRelationshipsQuestions } from './question-banks/thrive-relationships-questions.js';
        import { thriveThoughtsQuestions } from './question-banks/thrive-thoughts-questions.js';

        // Combine and transform questions for viral game format
        const allQuestions = [
            ...thriveVitalityQuestions,
            ...thriveRelationshipsQuestions,
            ...thriveThoughtsQuestions
        ];

        // Transform THRIVE questions to viral game format
        function transformQuestionForGame(q) {
            // Analyze options to determine automatic vs conscious patterns
            const transformedOptions = q.options.map(opt => {
                // Patterns suggesting automatic behavior (high N, low C, negative E)
                const isAutomatic = (
                    (opt.ocean?.N > 0.5) ||
                    (opt.ocean?.C < -0.2) ||
                    (opt.ocean?.E < -0.3)
                );

                return {
                    text: opt.text,
                    pattern: isAutomatic ? 'automatic' : 'conscious',
                    domain: q.domain || 'vitality',
                    ocean: opt.ocean
                };
            });

            return {
                id: q.id,
                scenario: q.scenario,
                options: transformedOptions,
                revelationScore: calculateRevelationScore(q),
                category: q.category || 'general',
                reflectionTrigger: shouldTriggerReflection(q)
            };
        }

        function calculateRevelationScore(q) {
            // Higher revelation for questions with clear automatic/conscious split
            const oceanRange = q.options.reduce((max, opt) => {
                const score = Math.abs(opt.ocean?.N || 0) + Math.abs(opt.ocean?.E || 0);
                return Math.max(max, score);
            }, 0);
            return Math.min(10, Math.floor(oceanRange * 5));
        }

        function shouldTriggerReflection(q) {
            // Trigger reflection on high-impact questions
            return q.reveals?.includes('burnout_risk') ||
                   q.reveals?.includes('values_alignment') ||
                   q.category === 'work_motivation';
        }

        // Select 10 best questions for viral game
        const gameQuestions = allQuestions
            .map(transformQuestionForGame)
            .filter(q => q.revelationScore >= 6)
            .sort(() => Math.random() - 0.5)
            .slice(0, 10);

        // Game state
        let currentQuestion = 0;
        let responses = [];
        let lastResponse = null;

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Start the game
        window.startGame = function() {
            hideScreen('welcome-screen');
            setTimeout(() => {
                showScreen('question-screen');
                showQuestion();
            }, 150);
        };

        // Show current question
        function showQuestion() {
            if (currentQuestion >= gameQuestions.length) {
                showResults();
                return;
            }

            const question = gameQuestions[currentQuestion];
            const progress = ((currentQuestion + 1) / gameQuestions.length) * 100;

            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('question-number').textContent = `Question ${currentQuestion + 1} of ${gameQuestions.length}`;
            document.getElementById('question-text').textContent = question.scenario;

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option.text;
                optionElement.onclick = () => selectOption(index, option, question);
                optionsContainer.appendChild(optionElement);
            });
        }

        // Handle option selection
        window.selectOption = function(optionIndex, option, question) {
            // Visual feedback
            document.querySelectorAll('.option').forEach((opt, idx) => {
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                } else {
                    opt.classList.remove('selected');
                }
            });

            const response = {
                questionIndex: currentQuestion,
                questionId: question.id,
                optionIndex: optionIndex,
                option: option,
                timestamp: Date.now(),
                wasReflected: false
            };

            lastResponse = response;

            // Check for reflection trigger at positions 3, 6, 9
            if ([2, 5, 8].includes(currentQuestion) && question.reflectionTrigger && !question.hasBeenReflected) {
                question.hasBeenReflected = true;
                setTimeout(() => {
                    hideScreen('question-screen');
                    setTimeout(() => showScreen('reflection-screen'), 150);
                }, 900);
            } else {
                responses.push(response);
                currentQuestion++;
                setTimeout(() => {
                    const card = document.getElementById('game-card');
                    card.classList.add('fade-out');
                    setTimeout(() => {
                        showQuestion();
                        card.classList.remove('fade-out');
                    }, 150);
                }, 900);
            }
        };

        // Reflection handlers
        window.changeAnswer = function() {
            hideScreen('reflection-screen');
            setTimeout(() => showScreen('question-screen'), 150);
        };

        window.continueFromReflection = function() {
            lastResponse.wasReflected = true;
            responses.push(lastResponse);
            currentQuestion++;

            hideScreen('reflection-screen');
            setTimeout(() => {
                showScreen('question-screen');
                showQuestion();
            }, 150);
        };

        // Analyze responses
        function analyzeResponses() {
            const automaticCount = responses.filter(r => r.option.pattern === 'automatic').length;
            const consciousCount = responses.filter(r => r.option.pattern === 'conscious').length;
            const automaticPercentage = (automaticCount / responses.length) * 100;
            const reflectionCount = responses.filter(r => r.wasReflected).length;

            let patternType, patternTitle, patternDescription;

            if (automaticPercentage >= 70) {
                patternType = 'significant_automatic';
                patternTitle = 'ðŸŽ¯ You\'re Running on Autopilot';
                patternDescription = `Your responses reveal a strong tendency toward automatic, script-driven choices (${automaticPercentage.toFixed(0)}% automatic). This is incredibly common and represents your greatest opportunity for transformation. When you begin making more conscious choices aligned with your authentic desires, you\'ll unlock unprecedented levels of fulfillment.${reflectionCount > 0 ? ` The good news? You reflected on ${reflectionCount} of your answers, showing emerging self-awareness.` : ''}`;
            } else if (automaticPercentage >= 40) {
                patternType = 'mixed_pattern';
                patternTitle = 'âš–ï¸ You\'re in Transition';
                patternDescription = `You show a blend of automatic (${automaticPercentage.toFixed(0)}%) and conscious (${(100-automaticPercentage).toFixed(0)}%) responses. You\'re conscious in some areas while still operating from unconscious scripts in others. This is the perfect stage for accelerated growth.${reflectionCount > 0 ? ` Your willingness to reflect on ${reflectionCount} answers shows you\'re actively developing conscious choice-making.` : ''}`;
            } else {
                patternType = 'conscious_orientation';
                patternTitle = 'ðŸŒŸ You\'re Unusually Conscious';
                patternDescription = `You demonstrate a strong tendency toward conscious, intentional decision-making (${(100-automaticPercentage).toFixed(0)}% conscious). This is relatively rare and indicates well-developed self-awareness.${reflectionCount > 0 ? ` Your reflection on ${reflectionCount} answers shows sophisticated self-monitoring.` : ''} Your next growth edge is deepening this consciousness and understanding exactly where your remaining automatic patterns show up.`;
            }

            return {
                patternType,
                patternTitle,
                patternDescription,
                automaticPercentage,
                consciousPercentage: 100 - automaticPercentage,
                reflectionCount
            };
        }

        // Show results
        function showResults() {
            const analysis = analyzeResponses();

            // Store results for potential Stage 2
            sessionStorage.setItem('viralGameResults', JSON.stringify({
                responses,
                analysis,
                timestamp: Date.now()
            }));

            document.getElementById('pattern-result').innerHTML = `
                <div class="pattern-title">${analysis.patternTitle}</div>
                <div class="pattern-description">${analysis.patternDescription}</div>
            `;

            hideScreen('question-screen');
            setTimeout(() => showScreen('results-screen'), 150);
        }

        // Navigation functions
        window.continueToDeepDive = function() {
            // Navigate to Stage 2 - Domain deep dive
            window.location.href = '/viral-game-stage2.html';
        };

        window.skipToFullAssessment = function() {
            // Navigate directly to full OCEAN assessment
            window.location.href = '/ocean-assessment.html';
        };

        window.restartGame = function() {
            currentQuestion = 0;
            responses = [];
            lastResponse = null;

            gameQuestions.forEach(q => q.hasBeenReflected = false);

            hideScreen('results-screen');
            setTimeout(() => showScreen('welcome-screen'), 150);
        };

        // Screen management
        function hideScreen(screenId) {
            document.getElementById(screenId).style.display = 'none';
        }

        function showScreen(screenId) {
            document.getElementById(screenId).style.display = 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
        });
    </script>
</body>
</html>
